{% extends 'core/home.html' %}
{% load static %}

{% block conversation %}
    <div id="chat-container" class="py-6 py-lg-12">
        {% for message in message_list %}
            {% if message.user %}

                <!-- Message -->
                <div class="message message-out">

                    <div class="avatar">
                        <span class="avatar-text">U</span>
                    </div>


                    <div class="message-inner">
                        <div class="message-body">
                            <div class="message-content">
                                <div class="message-text">
                                    <p>{{ message.content }}</p>
                                </div>

                                <!-- Dropdown -->
                                <div class="message-action">
                                    <div class="dropdown">
                                        <a class="icon text-muted"
                                           href="{% static '' %}Messenger - 2.2.0.html"
                                           role="button" data-bs-toggle="dropdown"
                                           aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                 height="24" viewBox="0 0 24 24" fill="none"
                                                 stroke="currentColor" stroke-width="2"
                                                 stroke-linecap="round" stroke-linejoin="round"
                                                 class="feather feather-more-vertical">
                                                <circle cx="12" cy="12" r="1"></circle>
                                                <circle cx="12" cy="5" r="1"></circle>
                                                <circle cx="12" cy="19" r="1"></circle>
                                            </svg>
                                        </a>

                                        <ul class="dropdown-menu">
                                            <li>
                                                <a class="dropdown-item d-flex align-items-center"
                                                   href="{% static '' %}Messenger - 2.2.0.html">
                                                    <span class="me-auto">Edit</span>
                                                    <div class="icon">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                             width="24" height="24"
                                                             viewBox="0 0 24 24"
                                                             fill="none" stroke="currentColor"
                                                             stroke-width="2"
                                                             stroke-linecap="round"
                                                             stroke-linejoin="round"
                                                             class="feather feather-edit-3">
                                                            <path d="M12 20h9"></path>
                                                            <path
                                                                    d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z">
                                                            </path>
                                                        </svg>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item d-flex align-items-center"
                                                   href="{% static '' %}Messenger - 2.2.0.html">
                                                    <span class="me-auto">Reply</span>
                                                    <div class="icon">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                             width="24" height="24"
                                                             viewBox="0 0 24 24"
                                                             fill="none" stroke="currentColor"
                                                             stroke-width="2"
                                                             stroke-linecap="round"
                                                             stroke-linejoin="round"
                                                             class="feather feather-corner-up-left">
                                                            <polyline
                                                                    points="9 14 4 9 9 4"></polyline>
                                                            <path d="M20 20v-7a4 4 0 0 0-4-4H4"></path>
                                                        </svg>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <hr class="dropdown-divider">
                                            </li>
                                            <li>
                                                <a class="dropdown-item d-flex align-items-center text-danger"
                                                   href="{% static '' %}Messenger - 2.2.0.html">
                                                    <span class="me-auto">Delete</span>
                                                    <div class="icon">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                             width="24" height="24"
                                                             viewBox="0 0 24 24"
                                                             fill="none" stroke="currentColor"
                                                             stroke-width="2"
                                                             stroke-linecap="round"
                                                             stroke-linejoin="round"
                                                             class="feather feather-trash-2">
                                                            <polyline
                                                                    points="3 6 5 6 21 6"></polyline>
                                                            <path
                                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                            </path>
                                                            <line x1="10" y1="11" x2="10"
                                                                  y2="17">
                                                            </line>
                                                            <line x1="14" y1="11" x2="14"
                                                                  y2="17">
                                                            </line>
                                                        </svg>
                                                    </div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="message-gallery">
                                <div class="row gx-3">
                                    {% for img in message.images %}
                                        <div class="col">
                                            <img class="img-fluid rounded"
                                                 src="{{ img }}" data-action="zoom"
                                                 alt="" style="">
                                        </div>
                                    {% endfor %}


                                </div>
                            </div>

                        </div>

                        <div class="message-footer">
                            <span class="extra-small text-muted">08:45 PM</span>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Message -->
                <div class="message">
                    <div class="col-auto">
                        <div class="avatar avatar-online">
                            <span class="avatar-text">A</span>
                        </div>
                    </div>

                    <div class="message-inner">
                        <div class="message-body">
                            <div class="message-content">
                                <div class="message-text" style="white-space: pre-line;">
                                    {% if conversation.data_type == conversation.DB %}
                                        <p>{{ message.get_answer }}</p>
                                    {% else %}
                                        <p>{{ message.get_answer }}
                                            {# William is typing<span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>#}
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="message-gallery">
                                <div class="row gx-3">
                                    {% for img in message.images %}
                                        <div class="col">
                                            <img class="img-fluid rounded"
                                                 src="/fig/{{ message.conversation.id }}/{{ message.id }}/{{ img }}"
                                                 data-action="zoom"
                                                 alt="" style="">
                                        </div>
                                    {% endfor %}


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        <!-- Message -->
        <div id="hidden-out" class="message message-out" style="display: none">

            <div class="avatar">
                <span class="avatar-text">U</span>
            </div>


            <div class="message-inner">
                <div class="message-body">
                    <div class="message-content">
                        <div class="message-text">
                            <p id="new-query"></p>
                        </div>

                        <!-- Dropdown -->
                        <div class="message-action">
                            <div class="dropdown">
                                <a class="icon text-muted"
                                   href="{% static '' %}Messenger - 2.2.0.html"
                                   role="button" data-bs-toggle="dropdown"
                                   aria-expanded="false">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                         height="24" viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="2"
                                         stroke-linecap="round" stroke-linejoin="round"
                                         class="feather feather-more-vertical">
                                        <circle cx="12" cy="12" r="1"></circle>
                                        <circle cx="12" cy="5" r="1"></circle>
                                        <circle cx="12" cy="19" r="1"></circle>
                                    </svg>
                                </a>

                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center"
                                           href="{% static '' %}Messenger - 2.2.0.html">
                                            <span class="me-auto">Edit</span>
                                            <div class="icon">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     width="24" height="24"
                                                     viewBox="0 0 24 24"
                                                     fill="none" stroke="currentColor"
                                                     stroke-width="2"
                                                     stroke-linecap="round"
                                                     stroke-linejoin="round"
                                                     class="feather feather-edit-3">
                                                    <path d="M12 20h9"></path>
                                                    <path
                                                            d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z">
                                                    </path>
                                                </svg>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center"
                                           href="{% static '' %}Messenger - 2.2.0.html">
                                            <span class="me-auto">Reply</span>
                                            <div class="icon">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     width="24" height="24"
                                                     viewBox="0 0 24 24"
                                                     fill="none" stroke="currentColor"
                                                     stroke-width="2"
                                                     stroke-linecap="round"
                                                     stroke-linejoin="round"
                                                     class="feather feather-corner-up-left">
                                                    <polyline
                                                            points="9 14 4 9 9 4"></polyline>
                                                    <path d="M20 20v-7a4 4 0 0 0-4-4H4"></path>
                                                </svg>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center text-danger"
                                           href="{% static '' %}Messenger - 2.2.0.html">
                                            <span class="me-auto">Delete</span>
                                            <div class="icon">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     width="24" height="24"
                                                     viewBox="0 0 24 24"
                                                     fill="none" stroke="currentColor"
                                                     stroke-width="2"
                                                     stroke-linecap="round"
                                                     stroke-linejoin="round"
                                                     class="feather feather-trash-2">
                                                    <polyline
                                                            points="3 6 5 6 21 6"></polyline>
                                                    <path
                                                            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                    </path>
                                                    <line x1="10" y1="11" x2="10"
                                                          y2="17">
                                                    </line>
                                                    <line x1="14" y1="11" x2="14"
                                                          y2="17">
                                                    </line>
                                                </svg>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="message-gallery">
                        <div class="row gx-3">
                            {% for img in message.images %}
                                <div class="col">
                                    <img class="img-fluid rounded"
                                         src="{{ img }}" data-action="zoom"
                                         alt="" style="">
                                </div>
                            {% endfor %}


                        </div>
                    </div>

                </div>

                <div class="message-footer">
                    <span class="extra-small text-muted">08:45 PM</span>
                </div>
            </div>
        </div>

        <!-- Message -->
        <div id="hidden-in" class="message" style="display: none">
            <div class="col-auto">
                <div class="avatar avatar-online">
                    <span class="avatar-text">A</span>
                </div>
            </div>

            <div class="message-inner">
                <div class="message-body">
                    <div class="message-content">
                        <div class="message-text" style="white-space: pre-line;">

                            <p id="loading-response">{% comment %}{{ message.get_answer }}{% endcomment %}
                                <svg width="200px" height="200px" xmlns="http://www.w3.org/2000/svg"
                                     xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100"
                                     preserveAspectRatio="xMidYMid"
                                     style="background: none;">
                                    <circle cx="75" cy="50" fill="#363a3c" r="6.39718">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.875s"></animate>
                                    </circle>
                                    <circle cx="67.678" cy="67.678" fill="#363a3c" r="4.8">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.75s"></animate>
                                    </circle>
                                    <circle cx="50" cy="75" fill="#363a3c" r="4.8">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.625s"></animate>
                                    </circle>
                                    <circle cx="32.322" cy="67.678" fill="#363a3c" r="4.8">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.5s"></animate>
                                    </circle>
                                    <circle cx="25" cy="50" fill="#363a3c" r="4.8">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.375s"></animate>
                                    </circle>
                                    <circle cx="32.322" cy="32.322" fill="#363a3c" r="4.80282">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.25s"></animate>
                                    </circle>
                                    <circle cx="50" cy="25" fill="#363a3c" r="6.40282">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="-0.125s"></animate>
                                    </circle>
                                    <circle cx="67.678" cy="32.322" fill="#363a3c" r="7.99718">
                                        <animate attributeName="r" values="4.8;4.8;8;4.8;4.8" times="0;0.1;0.2;0.3;1"
                                                 dur="1s"
                                                 repeatCount="indefinite" begin="0s"></animate>
                                    </circle>
                                </svg>
                            </p>

                        </div>
                    </div>
                    <div class="message-gallery">
                        <div class="row gx-3">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block chat_form %}
    <form id="chat-form" class="chat-form rounded-pill bg-dark" data-emoji-form="" method="post"
          hx-target="#chat-container" hx-swap="outerHTML"
          hx-post="
                  {% if conversation %}{% url 'core:file-chat' conversation.id %}{% else %}{% url 'core:data-upload' %}{% endif %}"
            {% comment %}
                          action="

                                  {% if conversation %}{% url 'core:file-chat' conversation.id %}{% else %}{% url 'core:data-upload' %}{% endif %}"
                          {% endcomment %}
          enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row align-items-center gx-0">
            <div class="col-auto">
                                <span class="btn btn-icon btn-link text-body rounded-circle dz-clickable" id="dz-btn">

                                </span>
            </div>

            <div class="col">
                {% if not conversation %}
                    <div class="input-group">
                        <input name="attachment" type="file" class="form-control" id="inputGroupFile04"
                               aria-describedby="inputGroupFileAddon04"
                               accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                               aria-label="Upload">
                        {% comment %}
                                    <button class="btn btn-outline-secondary" type="submit" id="inputGroupFileAddon04">
                                        Button
                                    </button>
                                    {% endcomment %}
                    </div>
                {% else %}
                    <div class="input-group">
                                        <textarea name="query" required id="query" class="form-control px-0"
                                                  placeholder="Type your message..." rows="1"
                                                  data-emoji-input="" data-autosize="true"
                                                  style="overflow: hidden; overflow-wrap: break-word; resize: none; height: 47px;"></textarea>


                    </div>
                {% endif %}
            </div>

            <div class="col-auto">
                <button class="btn btn-icon btn-primary rounded-circle ms-5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                         viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" class="feather feather-send">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </form>
{% endblock %}

{% block js %}

{% endblock %}